# 12장: 기본 인증

요즘은 HTTP 자체 인증 기능보다는 각각의 인증 모듈을 이용해 '직접' 구현하지만 HTTP도 기본 인증을 제공하고 있으므로 한 번 살펴보자.

## 12.1 인증

### 12.1.1 HTTP의 인증요구/응답 프레임워크

웹 애플리케이션이 HTTP 요청 메시지를 받으면, 서버는 요청을 처리하는 대신 현재 사용자가 누구인지를 알 수 있게 개인 정보를 요구하는 '인증 요구'로 답할 수 있다.


### 12.1.2 인증 프로토콜과 헤더

HTTP에는 기본 인증과 다이제스트 인증이라는 두 개의 공식 인증 프로토콜이 있다.
(현대의 HTTP 인증요구/응답 프로토콜을 사용하는 인증 프로토콜로는 OAuth가 있다.
OAuth는 모바일 기기 같은 다양한 애플리케이션에서 API 인증을 위해 사용하는 인증 프로토콜이다.
자세한 내용은 RFC6749 참고, http://tools.ietf.org/html/rfc6749 )

| 단계 | 헤더 | 설명 | 메서드/상태 |
| --- | --- | --- | --- |
| 요청 | | 첫 번째 요청에는 인증 정보가 없다. | GET |
| 인증 요구 | WWW-Authenticate | 서버는 사용자에게 사용자 이름과 비밀번호를 제공하라는 지시의 의미로 401 상태 정보와 함께 요청을 반려한다. 서버에는 각각 다른 비밀번호가 이쓴 영역들이 있을 것이므로, 서버는 WWW-Authenticate 헤더에 해당 영역을 설명해 놓는다. | 401 Unauthorized |
| 인증 | Authorization | 클라이언트는 요청을 다시 보내는데, 이번에는 인증 알고리즘과 사용자 이름과 비밀번호를 기술한 Authorization 헤더를 함께 보낸다. | GET |
| 성공 | Authentication-Info | 인증 정보가 정확하면 서버는 문서와 함께 응답한다. 어떤 인증 알고리즘은 선택적인 헤더인 Authentication-Info에 인증 세션에 관한 추가 정보를 기술해서 응답하기도 한다. | 200 OK |


### 12.1.3 보안 영역

웹 서버는 기밀문서를 보안 영역(realm) 그룹으로 나눈다. 보안 영역은 저마다 다른 사용자 권한을 요구한다.


## 12.2 기본 인증

기본 인증은 가장 잘 알려진 HTTP 인증 규약이다. HTTP 인증의 상세 내용을 다루는 RFC 2617에 기술되어 있다.

기본 인증에서, 웹 서버는 클라이언트의 요청을 거부하고 유효한 사용자 이름과 비밀번호를 요구할 수 있다. 

### 12.2.1 기본 인증의 예

| 인증요구/응답 | 헤더 문법과 설명 |
| --- | --- |
| 인증요구(서버->클라이언트) | 각 사이트는 보안 영역마다 다른 비밀번호가 있을 것이다. realm은 요청 받은 문서 집합의 이름을 따옴표로 감싼 것으로, 사용자는 이 정보를 보고 어떤 비밀번호를 사용해야 하는지 알 수 있다. `WWW-Authenticate: Basic realm=따옴표로 감싼 문서 집합 정보` |
| 응답(클라이언트->서버) | 사용자 이름과 비밀번호는 콜론으로 잇고, base-64로 인코딩해서 사용자 이름과 비밀번호에 쉽게 국제문자를 포함할 수 있게 하고, 네트워크 트래픽에 사용자 이름고 비밀번호가 노출되지 않게 한다. `Authorization: Basic base-64로 인코딩한 사용자 이름과 비밀번호` |

기본 인증 프로토콜은 Authorization-Info 헤더를 사용하지 않는다.


### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

HTTP 기본 인증은 사용자 이름과 비밀번호를 콜론으로 이어서 합치고, base-64 인코딩 메서드를 사용해 인코딩한다. 
base-64 인코딩은 바이너리, 텍스트, 국제 문자 데이터 문자열을 받아서 전송할 수 있게, 그 문자열을 전송 가능한 문자인 알파벳으로 변환하기 위해 발명됐다.

base-64는 어렵지 않게 사용자 이름과 비밀번호 문자를 섞을 수 있기 때문에, 서버나 네트워크를 관리하면서 뜻하지 안헤 사용자 이름과 비밀번호가 노출되는 문제를 예방하는 데 도움이 된다.


### 12.2.3 프락시 인증

중개 프락시 서버를 통해 인증을 할 수 있다. 프락시 서버에서 접근 정책을 중앙 관리할 수 있기 때문에 회사 리소스 전체에 대해 통합적인 접근 제어를 하기 위해서 프락시 서버를 사용하면 좋다. 


## 12.3 기본 인증의 보안 결함

기본 인증은 단순하고 편리하지만 안심할 수 없다. 

1. base-64로 인코딩된 비밀번호는 사실상 '비밀번호 그대로' 보내는 것과 다름없다. 
2. 기본 인증은 재전송 공격을 예방하기 위한 어떤 일도 하지 않는다.
3. 보안이 뚫려도 치명적이지 않은 웹 사이트에 적용하더라도 캡쳐된 아이디 비밀번호가 다른 사이트에서 사용될 경우 치명적이다.
4. 프락시나 중개자가 중간에 개입하는 경우, 기본 인증은 정상적인 동작을 보장하지 않는다.
5. 가짜 서버의 위장에 취약하다.


